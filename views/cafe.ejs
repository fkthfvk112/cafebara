<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/stylesheets/cafe.css">


    <title>카페를 보여주는 페이지</title>
</head>

<body>
    <% layout('layouts/boilerplate') %>
    <section class="filterSection">
      <div class="row">
        <div class="text-center m-3" style="color:#2b2d42">
          <span class="filterText1" style="color:black">Search your cafe</span>
          <span  class ="filterText2To4">
            <span class="filterText2">menu</span>
            <span class="filterText3">name</span>
            <span class="filterText4">location/star/review</span>
          </span>
        </div>
        <form action="/cafe/filter"class="d-flex justify-content-center filterForm">
          <div class="filterContainer">
            <input style="min-width: 250px; width:40%;" type="text" name="filter[filterInput]">
            <input class="userLocation" style="display:none;" name="filter[userLocation]">
            <div class="selectContainer">
            <select name = filter[filter1]>
              <option value="study">
                공부
              </option>
              <option value="talk">
                수다
              </option>
              <option value="takeOut">
                테이크아웃
              </option>
              <option value="" selected>
                선택 안 함
              </option>
            </select>
            <select class="select2" name = filter[filter2]>
              <option value="highStar">
                별점 높은 순
              </option>
              <option value="lowStar">
                별점 낮은 순
              </option>
              <option value="highReview">
                리뷰 많은 순
              </option>
              <option  value="lowReview">
                리뷰 적은 순
              </option>
              <option class="close" value="closeToMe">
                거리 가까운 순
              </option>
              <option selected value="">
                선택 안 함
              </option>
            </select>
          </div>
            <button type="button" class="filterBtn">
              검색
            </button>
          </div>
        </form>
      </div>
    </section>
    <section>

      <div class="container" style="margin-top: 100px; margin-bottom: 100px;">
          <% for(let cafe of cafes) { %>
            <a class='card_link' href="/cafe/<%= cafe._id %>">
              <div class="card mb-3 cafeItem">
                  <div class="row g-0">
                    <div class="col-md-4">
                      <div style="text-align: left;">
                        <img class="m-3" src="<%= cafe.images[0].url %>" style="width: 200px; height: 200px; object-fit: contain;">
                      </div>
                    </div>
                    <div class="col-lg-7">
                      <div class="card-body text-start">
                        <h5 class="card-title mb-3 ms-2"><%= cafe.name %></h5>
                        <p class="card-text">위치 : <%= cafe.location %> </p>
                        <% let cnt = 0 %>
                        <% for(let menu of cafe.repreMenu) {%>
                          <span class="card-text"><%= menu.name %>
                          <% if(cnt != 2){%>
                            ,
                          <% } %>
                          <% cnt++ %>
                          </span>
                        <% }  %>
                      </div>
                    </div>
                  </div>
                </div>
              </a>
          <% } %>
        </div>
    </section>
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous">

</script>
                    
</body>

</html>
<script>
  const select2 = document.querySelector(".select2");
  const filterForm = document.querySelector(".filterForm");
  const filterBtn = document.querySelector(".filterBtn");
  const close = document.querySelector(".close");
  const userLocation = document.querySelector(".userLocation");

  filterBtn.addEventListener('click', async()=>{
    if(select2.value === "closeToMe"){
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
      } else {
        alert("브라우저에서 현재 위치 정보를 지원하지 않습니다.")
        console.log("Geolocation is not supported by this browser.");
      }

       function successCallback(position) {
        const location = {
          latitude:position.coords.latitude,
          longitude:position.coords.longitude
        }
        console.log("Latitude: " + position.coords.latitude +
        ", Longitude: " + position.coords.longitude);
        console.log(JSON.stringify(location));
        userLocation.value = JSON.stringify(location);
        filterForm.submit();
      }

      function errorCallback(error) {
        console.log("Unable to retrieve your location due to " + error.code + ": " + error.message);
      }
    }
    else{
      filterForm.submit();
    }
  })

  //get user's geo

</script>